---
title: SameSite Strict bypass via client-side redirect
date: 2025-10-24 00:00:00 +0800
categories: [Portswigger, Cross-site request forgery (CSRF)]
tags: [portswigger, writeup, walkthrough, web, csrf]     # TAG names should always be lowercase
description: In this post we will solve a CSRF Lab on portswigger, have fun reading.
---

## Lab: SameSite Strict bypass via client-side redirect

This lab's change email function is vulnerable to CSRF. To solve the lab, perform a CSRF attack that changes the victim's email address. You should use the provided exploit server to host your attack.

You can log in to your own account using the following credentials: `wiener:peter`

### Lab 8 Exploitation

Our goal is to exploit the vulnerable functionality in this website and make sure that the csrf vulnerability works so let's start 

First we will open burpsuite before doing anything so that we can see all of the requests that our website is doing, then login to `wiener` account with the credentials we have.

![img-description](/assets/img/PortSwigger/CSRF/8/cookie.png)
_Cookie_

The first thing we we will do is to check the login request and let's see what cookies did the website assigned to us, and as we can see it granted us a `SameSite` cookie and it's value is `strict` which will make our mission a bit difficult, but what is a Strict SameSite Cookie?

### Strict

If a cookie is set with the `SameSite=Strict` attribute, browsers will not send it in any cross-site requests. In simple terms, this means that if the target site for the request does not match the site currently shown in the browser's address bar, it will not include the cookie.

This is recommended when setting cookies that enable the bearer to modify data or perform other sensitive actions, such as accessing specific pages that are only available to authenticated users.

Although this is the most secure option, it can negatively impact the user experience in cases where cross-site functionality is desirable.

so how can we bypass that?

when i was reading from [Portswigger](https://portswigger.net/web-security/csrf/bypassing-samesite-restrictions#bypassing-samesite-restrictions-using-on-site-gadgets) i found this paragraph talking about this attack

> One possible gadget is a client-side redirect that dynamically constructs the redirection target using attacker-controllable input like URL parameters.
As far as browsers are concerned, these client-side redirects aren't really redirects at all; the resulting request is just treated as an ordinary, standalone request. Most importantly, this is a same-site request and, as such, will include all cookies related to the site, regardless of any restrictions that are in place.

> If you can manipulate this gadget to elicit a malicious secondary request, this can enable you to bypass any SameSite cookie restrictions completely.

So now we need to find a way of redirection inside of the website itself so that we can bypass the restrictions, let's discover our website more.

we can find that there is some posts in the home page that we can comment on them.

![img-description](/assets/img/PortSwigger/CSRF/8/comment.png)
_Comment_

let's try to comment and see what will happen.

![img-description](/assets/img/PortSwigger/CSRF/8/Redirect.png)
_Redirection_

and we can see that a redirection has happened here let's head to burpsuite and see what happens in the requests

There are three main requests the one that posts the comment, the redirection one, and a request that gets a javascript from the site resources 

![img-description](/assets/img/PortSwigger/CSRF/8/js.png)
_Javascript_

upon reading the script we can see that this is the script that is responsible for redirecting us, it takes the postid without any sanitization directly from the user and that's very dangerous thing which we will take advantage of.

it seems now that we can bypass the restrictions easily with this functionality so let's try to craft our exploit.

```
<script>
   document.location="https://0a8300b303b6490d80481c9c004700cc.web-security-academy.net/post/comment/confirmation?postId=8"
</script>
```

Starting with our first most basic one head to the exploit server and put this payload to ensure that the redirection happens properly, then click **view exploit** and you will see that it works fine.

Now we need to go to the **change email** page and to do that we will need to put our change email endpoint after the **postid** parameter, go change your email to find the endpoint.

![img-description](/assets/img/PortSwigger/CSRF/8/email.png)
_Email_

Here is our endpoint and also as we can see this time we have 2 parameters the **email** parameter and the **submit** parameter so let's keep this in mind.

```
<script>
   document.location="https://0a8300b303b6490d80481c9c004700cc.web-security-academy.net/post/comment/confirmation?postId=8/my-account/change-email"
</script>
```

Now add the endpoint after the postid and let's click on view exploit again.

![img-description](/assets/img/PortSwigger/CSRF/8/NotFound.png)
_Not Found_

we can see that the redirection happens correctly but it adds to the url another path **/post/8** the first one is the 8 and we will remove that and the other one is the **post** and i think we can remove that using path traversal, let's try it.

```
<script>
   document.location="https://0a8300b303b6490d80481c9c004700cc.web-security-academy.net/post/comment/confirmation?postId=../my-account/change-email"
</script>
```

and it worked we have been redirected successfully

![img-description](/assets/img/PortSwigger/CSRF/8/worked.png)
_Successful Redirection_

but it tell's us that is missing the submit paramter which we have talked about in the previous change email request so now in order to complete our exploit we must add the two parameters

```
<script>
   document.location="https://0aba00000334592b8165597500850028.web-security-academy.net/post/comment/confirmation?postId=../my-account/change-email?email=test%40wiener.net%26submit=1"
</script>
```

Now again click on the view exploit and try one more last time.

![img-description](/assets/img/PortSwigger/CSRF/8/changed.png)
_Changed Email_
 
Done it worked succesfully, now change the email because no two users can have the same email and send the exploit to the victim.

![img-description](/assets/img/PortSwigger/CSRF/8/Solved.png)
_Solved_
 
and after waiting the three seconds which is the time that was in the script we will see that the lab is solved.