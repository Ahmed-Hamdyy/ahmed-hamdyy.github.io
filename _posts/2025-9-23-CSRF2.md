---
title: CSRF where token validation depends on request method
date: 2025-9-23 00:00:00 +0800
categories: [Portswigger, Cross-site request forgery (CSRF)]
tags: [portswigger, writeup, walkthrough, web, csrf]     # TAG names should always be lowercase
description: In this post we will solve a CSRF Lab on portswiggger, have fun reading.
---

## Lab: CSRF where token validation depends on request method

This lab's email change functionality is vulnerable to CSRF. It attempts to block CSRF attacks, but only applies defenses to certain types of requests.

To solve the lab, use your exploit server to host an HTML page that uses a CSRF attack to change the viewer's email address.

You can log in to your own account using the following credentials: `wiener:peter`

### Lab 2 Exploitation

Our goal is to exploit the vulnerable functionality in this website and make sure that the csrf vulnerability works so let's start 

First we will open burpsuite before doing anything so that we can see all of the requests that our website is doing, then login to `wiener` account with the credentials we have.

![img-description](/assets/img/PortSwigger/CSRF/2/mail.png)
_Changing Email_

We will find that we can change our account email so put any email and click on the update email and we will see that it is updated now, after we have seen that it is updated let's see our request in burpsuite.

![img-description](/assets/img/PortSwigger/CSRF/2/req.png)
_Request_

We will see that this is the request that changed our email, but they have managed to put a csrf token to block our attack so let's see how can we bypass that.

Send your request to Repeater `Ctrl+R` and as we can see in the image the request that was sent was a post request so let's change the request method (Right click and choose the change request method), change the email in the request to see if it will work or not and also remove the csrf token and let's see what will happen.

![img-description](/assets/img/PortSwigger/CSRF/2/Trial.png)
_Changing Method_

And as we can see it worked, so let's start sending it to our target via the exploit server.

let's craft our poc

```
<html>
    <body>
        <form action="https://vulnerable-website.com/email/change" method="Get">
            <input type="hidden" name="email" value="pwned@evil-user.net" />
        </form>
        <script>
            document.forms[0].submit();
        </script>
    </body>
</html>
```

Change the data in this code with your lab relevant data, and make sure you have chosen a different mail again because no two users should have the same email.

![img-description](/assets/img/PortSwigger/CSRF/2/Exploit.png)
_POC_

and your request should be something like this, now Deliver exploit to victim.

![img-description](/assets/img/PortSwigger/CSRF/2/solved.png)
_Solved_

and you will see that the lab is solved.



